{"kind":"@shape","id":"PathList","fields":{"paths":"list<str>"}}
{"kind":"@shape","id":"DocText","fields":{"text":"str"}}
{"kind":"@shape","id":"Summary","fields":{"title":"str","summary":"str"}}
{"kind":"@shape","id":"WriteOK","fields":{"ok":"bool"}}
{"kind":"@fn","id":"read_paths","in":{},"out":"PathList","@op":[["read_stdin", {"mode":"all"}, {"as":"input"}], ["split", {"text":"$input.text","sep":"\n"}, {"as":"lines"}], ["filter_nonempty_strings", {"items":"$lines"}, {"as":"paths"}]],"@expect":{"type":"PathList","synthesize":true}}
{"kind":"@shape","id":"TextInput","fields":{"text":"str"}}
{"kind":"@fn","id":"summarize_one","in":{"text":"str"},"out":"WriteOK","@op":[["read_file", {"path":"$text"}, {"as":"doc"}], ["path_basename", {"path":"$text"}, {"as":"base"}], ["join", {"items":["SUMMARY_","$base",".md"], "sep":""}, {"as":"out_path"}], ["llm", {"task":"summarize_document","input":{"text":"$doc.text"},"schema":"Summary"}, {"as":"sum"}], ["json_get", {"obj":"$sum","path":"title"}, {"as":"title"}], ["json_get", {"obj":"$sum","path":"summary"}, {"as":"summary"}], ["join", {"items":["# ","$title","\n\n","$summary","\n"], "sep":""}, {"as":"content"}], ["write_file", {"path":"$out_path","text":"$content"}]],"@expect":{"type":"WriteOK","synthesize":true}}
{"kind":"@fn","id":"process_all","in":{"paths":"PathList"},"out":"WriteOK","@op":[["map_each", {"items":"$paths.paths","fn":"summarize_one","param":"text"}], ["json_parse", {"text":"{\"ok\": true}"}]],"@expect":{"type":"WriteOK","synthesize":true}}
{"kind":"@flow","edges":[["read_paths","process_all",{}]]}
